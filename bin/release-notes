#!/usr/bin/env ruby

release = `gh release list`.lines.first[/\s(v[\d.]+)/, 1]
note = `gh release view #{release}`

regexp = /- Update rubocop.* requirement from .* \((#\d+)\) @\[?dependabot\b.*\n/
prs = note.scan(regexp).flatten.sort
consolidated = "- Update rubocop gems (#{prs.join(", ")}) @dependabot\n"

edited = note.gsub(regexp) do |match|
  match.include?(prs.first) ? consolidated : ""
end

headings = note.scan(/^## .*?(\w[\w\s]+)/).flatten.map(&:strip)
if headings == ["Housekeeping"] && !note.match?(/This is a gem housekeeping release/)
  edited = edited.sub(/^## /, "This is a gem housekeeping release. No user-facing changes.\n\n\\0")
end

puts edited
